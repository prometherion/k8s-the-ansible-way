---
  - name: Installing the Client Tools
    hosts: localhost
    roles:
      - client-tools  

  - name: Provisioning a CA and Generating TLS Certificates
    hosts: localhost
    roles:
      - certificate-authority

  - name: Distributing Client Certificates for Controllers
    hosts: controllers
    roles:
      - role: certificate-authority-deployer
        items:
          - "./../certificate-authority/files/ca.pem"
          - "./../certificate-authority/files/ca-key.pem"
          - "./../certificate-authority/files/kubernetes-key.pem"
          - "./../certificate-authority/files/kubernetes.pem"

  - name: Distributing Client Certificates for Workers
    hosts: workers
    roles:
      - role: certificate-authority-deployer
        items:
          - "./../certificate-authority/files/ca.pem"
          - "./../certificate-authority/files/{{ ansible_nodename }}-key.pem"
          - "./../certificate-authority/files/{{ ansible_nodename }}.pem"

  - name: Kubernetes Configuration Files for Authentication
    hosts: localhost
    roles:
      - role: authentication-configs
        crt_path: "./../certificate-authority/files"

  - name: Distributing the Kubernetes Configuration Files
    hosts: workers
    roles:
      - authentication-configs-deployer
